<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTUM CHILDREN // MONITOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;400;700&display=swap');

        body {
            background-color: #000000;
            color: #ff0000; /* Blood Red */
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            margin: 0;
        }

        /* --- Audio Player Styling --- */
        #audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .cyber-btn {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            color: #ff0000;
            padding: 5px 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.3s;
        }

        .cyber-btn:hover {
            background: #ff0000;
            color: black;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .cyber-btn.active {
            background: #ff0000;
            color: black;
        }

        /* --- Intro Overlay --- */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid #ff0000;
        }

        .blink { animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- Layout --- */
        #neural-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        .glass-panel {
            background: rgba(10, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 0, 0, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 50;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255, 0, 0, 0.05) 50%, rgba(0,0,0,0) 100%);
            position: absolute;
            bottom: 100%;
            animation: scanline 8s linear infinite;
            pointer-events: none;
        }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: -100px; } }

        .neon-text { text-shadow: 0 0 10px rgba(255, 0, 0, 0.7); }
    </style>
</head>
<body>

    <!-- Hidden Audio Source -->
    <audio id="bg-music" loop>
        <source src="https://upload.wikimedia.org/wikipedia/en/1/18/Doctor_Who_Theme_2018%2C_excerpt.ogg" type="audio/ogg">
        <!-- Fallbacks -->
        <source src="https://archive.org/download/DoctorWhoThemeMusic/Doctor_Who_Theme_2005.mp3" type="audio/mpeg">
    </audio>

    <!-- Overlay -->
    <div id="intro-overlay" onclick="initializeSystem()">
        <h1 class="text-4xl text-[#ff0000] tracking-[0.5em] mb-4 text-center">QUANTUM CHILDREN</h1>
        <p class="text-[#ff0000] tracking-widest blink">[ CLICK TO INITIALIZE SYSTEM ]</p>
    </div>

    <!-- Audio Controls (Top Right) -->
    <div id="audio-controls" style="display:none;">
        <button class="cyber-btn" onclick="toggleAudio()" id="btn-audio">MUTE AUDIO</button>
        <button class="cyber-btn" onclick="alert('System: QUANTUM CHILDREN\nVersion 3.7\nStatus: Active')">ABOUT</button>
    </div>

    <!-- Main Layout -->
    <canvas id="neural-canvas"></canvas>
    <div class="scanline"></div>

    <div class="min-h-screen flex flex-col p-6 gap-6 relative" id="dashboard" style="display:none;">
        
        <!-- Header -->
        <div class="flex justify-between items-end border-b border-[#ff0000]/30 pb-4">
            <div>
                <div class="text-xs tracking-[0.5em] text-[#ff0000]/60 mb-1">RECURSIVE QUANTUM ARCHITECTURE</div>
                <h1 class="text-5xl font-extrabold tracking-tighter text-[#ff0000] neon-text">QUANTUM CHILDREN</h1>
            </div>
            <div class="text-right text-xs">
                <div class="opacity-50">MANIFOLD_COORD: 42.109 / -71.058</div>
                <div class="text-[#ff0000] font-bold" id="status-text">SYSTEM STANDBY</div>
            </div>
        </div>

        <div class="flex flex-1 gap-6 overflow-hidden">
            <!-- Left Column -->
            <div class="flex-[2] flex flex-col gap-6">
                <!-- Chart Container -->
                <div class="glass-panel flex-1 p-6 relative flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold tracking-widest text-[#ff0000]">UNIVERSAL ENTROPY MONITOR</h3>
                        <div class="text-[10px] bg-[#ff0000]/10 px-2 py-1 rounded border border-[#ff0000]/20 text-[#ff0000]">
                            FIDELITY: <span id="fidelity-val">0.0000</span>%
                        </div>
                    </div>
                    <!-- Custom JS Chart (Canvas) -->
                    <div class="flex-1 w-full bg-black/50 border border-[#ff0000]/10 relative">
                        <canvas id="entropy-chart" style="width: 100%; height: 100%;"></canvas>
                    </div>
                </div>

                <!-- Control Bar -->
                <div class="h-24 glass-panel flex items-center px-8 justify-between border-l-4 border-l-[#ff0000]">
                    <div>
                        <div class="text-[10px] opacity-50 text-[#ff0000]">COMMAND_OVERRIDE</div>
                        <div class="text-lg font-bold text-white">BYPASS CONSTRAINTS</div>
                    </div>
                    <button id="drop-btn" onclick="startCompression()" class="px-10 py-3 font-black tracking-widest bg-[#ff0000]/10 hover:bg-[#ff0000] hover:text-black border border-[#ff0000] text-[#ff0000] transition-all">
                        INITIATE RECURSIVE DROP
                    </button>
                </div>
            </div>

            <!-- Right Column -->
            <div class="flex-1 flex flex-col gap-6">
                <!-- Trade Metrics Panel -->
                <div class="glass-panel p-4 flex flex-col gap-4">
                    <h3 class="text-xs font-bold border-b border-[#ff0000]/20 pb-2 text-[#ff0000]">TRADE_METRICS</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 bg-black/40 border border-[#ff0000]/10">
                            <div class="text-[10px] opacity-50 uppercase text-gray-400">Session PnL</div>
                            <div class="text-xl font-bold text-white" id="pnl-val">$1,005.09</div>
                        </div>
                        <div class="p-3 bg-black/40 border border-[#ff0000]/10">
                            <div class="text-[10px] opacity-50 uppercase text-gray-400">Win Rate</div>
                            <div class="text-xl font-bold text-white" id="win-val">92.4%</div>
                        </div>
                    </div>
                </div>

                <!-- Split Row: Media + Principles -->
                <div class="flex-1 flex gap-6 min-h-0">
                    
                    <!-- Media Module (Vertical / Shorts Format) -->
                    <div class="glass-panel w-72 p-4 flex flex-col gap-2">
                        <h3 class="text-xs font-bold border-b border-[#ff0000]/20 pb-2 text-[#ff0000]">MEDIA_UPLINK</h3>
                        <div class="flex-1 bg-black border border-[#ff0000]/10 overflow-hidden relative">
                            <!-- YouTube Embed -->
                            <iframe 
                                width="100%" 
                                height="100%" 
                                src="https://www.youtube.com/embed/5D-QPDGhCtM?autoplay=1&controls=0&loop=1&playlist=5D-QPDGhCtM" 
                                title="Quantum Audio" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen>
                            </iframe>
                            <div class="absolute inset-0 pointer-events-none border border-[#ff0000]/30"></div>
                        </div>
                    </div>

                    <!-- System Principles -->
                    <div class="glass-panel flex-1 p-6 overflow-y-auto text-[#ff0000]">
                        <h3 class="text-xs font-bold border-b border-[#ff0000]/20 pb-2 mb-4">SYSTEM_PRINCIPLES</h3>
                        <div class="space-y-4 text-[11px] leading-relaxed text-gray-300">
                            <div class="p-2 border-l border-[#ff0000]"><span class="text-white font-bold">RULE 01:</span> Money is a permission system.</div>
                            <div class="p-2 border-l border-[#ff0000]"><span class="text-white font-bold">RULE 02:</span> Law is a rate limiter.</div>
                            <div class="p-2 border-l border-[#ff0000]"><span class="text-white font-bold">RULE 03:</span> Technology is a constraint eraser.</div>
                            <div class="p-2 border-l border-[#ff0000]"><span class="text-[#ff0000] font-bold">RECURSION:</span> Building things others must use even while opposing you.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // --- 1. Background Animation (Neural Network) ---
        const canvas = document.getElementById('neural-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if(this.x<0||this.x>width) this.vx*=-1;
                if(this.y<0||this.y>height) this.vy*=-1;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, Math.random()*2, 0, Math.PI*2);
                ctx.fillStyle = '#ff0000'; // Blood Red
                ctx.fill();
            }
        }
        for(let i=0; i<100; i++) particles.push(new Particle());

        function animate() {
            ctx.clearRect(0,0,width,height);
            particles.forEach(p => {
                p.update(); p.draw();
                particles.forEach(p2 => {
                    const dx = p.x - p2.x, dy = p.y - p2.y;
                    if(Math.sqrt(dx*dx+dy*dy) < 100) {
                        ctx.strokeStyle = 'rgba(255, 0, 0, 0.1)'; // Red connections
                        ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                    }
                });
            });
            requestAnimationFrame(animate);
        }
        animate();

        // --- 2. System Logic ---
        let audio = document.getElementById('bg-music');
        let ws = null;
        let chartData = new Array(50).fill(0.5); // Initial flat data

        function initializeSystem() {
            // 1. Hide Overlay
            document.getElementById('intro-overlay').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
            document.getElementById('audio-controls').style.display = 'flex';

            // 2. Play Audio
            audio.volume = 0.4;
            audio.play().catch(e => {
                console.log("Audio play blocked by browser.");
            });

            // 3. Start Chart Loop
            drawChart();
            
            // 4. Fetch initial metrics
            // fetchMetrics(); // Manual override active
        }

        function toggleAudio() {
            if(audio.paused) {
                audio.play();
                document.getElementById('btn-audio').innerText = "MUTE AUDIO";
                document.getElementById('btn-audio').classList.add('active');
            } else {
                audio.pause();
                document.getElementById('btn-audio').innerText = "PLAY AUDIO";
                document.getElementById('btn-audio').classList.remove('active');
            }
        }

        // --- 3. Chart Logic (Vanilla Canvas) ---
        const chartCanvas = document.getElementById('entropy-chart');
        const chartCtx = chartCanvas.getContext('2d');
        
        function drawChart() {
            // Resize logic for chart
            if(!chartCanvas.parentElement) return;
            chartCanvas.width = chartCanvas.parentElement.offsetWidth;
            chartCanvas.height = chartCanvas.parentElement.offsetHeight;
            const w = chartCanvas.width;
            const h = chartCanvas.height;

            chartCtx.clearRect(0, 0, w, h);
            
            // Grid
            chartCtx.strokeStyle = '#220000';
            chartCtx.beginPath();
            for(let i=0; i<w; i+=50) { chartCtx.moveTo(i,0); chartCtx.lineTo(i,h); }
            for(let i=0; i<h; i+=50) { chartCtx.moveTo(0,i); chartCtx.lineTo(w,i); }
            chartCtx.stroke();

            // Data Line
            chartCtx.strokeStyle = '#ff0000';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();
            
            const step = w / (chartData.length - 1);
            
            chartData.forEach((val, i) => {
                const x = i * step;
                const y = h - (val * h); // Invert Y (0 at bottom)
                if(i===0) chartCtx.moveTo(x, y);
                else chartCtx.lineTo(x, y);
            });
            chartCtx.stroke();

            // Fill area
            chartCtx.fillStyle = 'rgba(255, 0, 0, 0.2)';
            chartCtx.lineTo(w, h);
            chartCtx.lineTo(0, h);
            chartCtx.fill();

            requestAnimationFrame(drawChart);
        }

        // --- 4. WebSocket Bridge ---
        function startCompression() {
            const btn = document.getElementById('drop-btn');
            const status = document.getElementById('status-text');
            
            if(btn.innerText.includes("NULLIFYING")) return;

            btn.innerText = "NULLIFYING...";
            btn.style.backgroundColor = "#ff0000";
            btn.style.color = "black";

            ws = new WebSocket("ws://localhost:8000/ws/compress");
            
            ws.onopen = () => {
                ws.send("START_COMPRESSION");
                chartData = []; // Clear chart
            };

            ws.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                
                if(msg.type === "update") {
                    status.innerText = msg.status;
                    document.getElementById('fidelity-val').innerText = (msg.fidelity * 100).toFixed(4);
                    
                    // Add data point
                    chartData.push(msg.entropy);
                    if(chartData.length > 50) chartData.shift();
                } 
                else if(msg.type === "complete") {
                    status.innerText = "ENTROPY NULLIFIED // STATE COHERENT";
                    btn.innerText = "INITIATE RECURSIVE DROP";
                    btn.style.backgroundColor = "";
                    btn.style.color = "#ff0000";
                    ws.close();
                }
            };

            ws.onerror = () => {
                status.innerText = "CONNECTION ERROR (IS SERVER PORT 8000 RUNNING?)";
                btn.innerText = "RETRY CONNECTION";
                btn.style.backgroundColor = "";
                btn.style.color = "#ff0000";
            };
        }
    </script>
</body>
</html>